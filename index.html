<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Motorradtabelle</title>
  <style>
    table {
      border-collapse: collapse;
      font-family: Arial, sans-serif;
      table-layout: auto;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      white-space: nowrap;
    }
    th {
      background-color: #f2f2f2;
      cursor: pointer;
    }
    th:hover {
      background-color: #e0e0e0;
    }
    td.image-cell {
      padding: 6px;
      height: 60px;
      overflow: hidden;
      line-height: 0;
    }
    td.image-cell a {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      text-decoration: none;
      color: inherit;
    }
    td.image-cell img {
      display: block;
      max-width: 100%;
      max-height: 90px;
      height: auto;
      object-fit: scale-down;
      margin: 0 auto;
      border: none;
      padding: 0;
    }
  </style>
</head>
<body>

  <h2>Motorradtabelle</h2>

  <!-- Eingabe- und Steuerungselemente -->
  <input id="importCode" placeholder="Import-Code hier einfügen" style="margin:10px; width:300px; padding:5px;" />
  <button id="importBtn" style="margin:10px; padding:6px 12px;">Importieren</button>
  <button id="exportBtn" style="margin:10px; padding:6px 12px;">Export-Code erstellen</button>
  <button id="resetBtn" style="margin:10px; padding:6px 12px;">Alle Zeilen einblenden</button>

  <table>
    <thead>
      <tr>
        <th></th>
        <th data-column-type="text">Hersteller</th>
        <th data-column-type="text">Modell</th>
        <th style="text-align: center;">Bild<br>(klick zum vergrößern)</th>
        <th data-column-type="number">Hubraum (ccm)</th>
        <th data-column-type="text">Leistung (PS @ U/min)</th>
        <th data-column-type="text">Drehmoment (Nm @ U/min)</th>
        <th data-column-type="number">Baujahr</th>
        <th data-column-type="number">Leergewicht (kg)</th>
        <th data-column-type="number">Tankinhalt (L)</th>
        <th data-column-type="number">Preis (UVP)</th>
        <th data-column-type="text">Links</th>
      </tr>
    </thead>
    <tbody id="tabledaten">
      <!-- Zeilen werden dynamisch geladen -->
    </tbody>
  </table>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const STORAGE_KEY = 'versteckteModelle';

      function getHiddenModels() {
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      }

      function saveHiddenModels(models) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(models));
      }

      fetch('bike_data.html')
        .then(response => response.text())
        .then(data => {
          const tbody = document.getElementById('tabledaten');
          tbody.innerHTML = data;

          // Bilder und Sichtbarkeit initialisieren
          const hiddenModels = getHiddenModels();
          document.querySelectorAll('td.image-cell').forEach(cell => {
            const imgUrl = cell.getAttribute('data-img-src');
            if (imgUrl) {
              const anchor = cell.querySelector('a');
              const img = cell.querySelector('img');
              if (anchor) anchor.href = imgUrl;
              if (img) img.src = imgUrl;
            }
          });

          document.querySelectorAll('tbody tr').forEach(row => {
            const model = row.children[2]?.innerText.trim();
            const checkbox = row.querySelector('.toggle-row');

            if (hiddenModels.includes(model)) {
              row.style.display = 'none';
              if (checkbox) checkbox.checked = false;
            }

            if (checkbox) {
              checkbox.addEventListener('change', function () {
                let updated = getHiddenModels();
                if (!this.checked) {
                  row.style.display = 'none';
                  if (!updated.includes(model)) updated.push(model);
                } else {
                  row.style.display = '';
                  updated = updated.filter(m => m !== model);
                }
                saveHiddenModels(updated);
              });
            }
          });
        });

      // Sortierung
      const getCellValue = (tr, idx, type) => {
        let val = tr.children[idx]?.innerText || '';
        if (type === 'number') return parseFloat(val.replace('€', '').replace(/\./g, '').replace(',', '.'));
        if (type === 'text') return val.trim().toLowerCase();
        return val;
      };

      const comparer = (idx, asc, type) => (a, b) => {
        const valA = getCellValue(a, idx, type);
        const valB = getCellValue(b, idx, type);
        if (typeof valA === 'number' && typeof valB === 'number') return asc ? valA - valB : valB - valA;
        return asc ? valA.localeCompare(valB) : valB.localeCompare(valA);
      };

      document.querySelectorAll('th').forEach(th => {
        if (th.cellIndex === 3) return; // Bildspalte nicht sortierbar
        let sortDirection = 1;
        th.addEventListener('click', () => {
          const table = th.closest('table');
          const tbody = table.querySelector('tbody');
          const rows = Array.from(tbody.querySelectorAll('tr'));
          const columnIndex = th.cellIndex;
          const columnType = th.getAttribute('data-column-type');
          rows.sort(comparer(columnIndex, sortDirection === 1, columnType));
          sortDirection *= -1;
          rows.forEach(row => tbody.appendChild(row));
        });
      });

      // Reset-Button
      document.getElementById('resetBtn').addEventListener('click', function () {
        localStorage.removeItem(STORAGE_KEY);
        document.querySelectorAll('tbody tr').forEach(row => {
          row.style.display = '';
          const cb = row.querySelector('.toggle-row');
          if (cb) cb.checked = true;
        });
      });

      // Export-Button
      document.getElementById('exportBtn').addEventListener('click', function () {
        const hidden = getHiddenModels();
        if (hidden.length === 0) {
          alert('Keine ausgeblendeten Modelle vorhanden.');
          return;
        }
        const code = btoa(JSON.stringify(hidden));
        prompt('Teile diesen Code mit anderen:', code);
      });

      // Import-Button
      document.getElementById('importBtn').addEventListener('click', function () {
        const code = document.getElementById('importCode').value.trim();
        if (!code) return alert('Bitte Code eingeben.');
        let imported;
        try {
          imported = JSON.parse(atob(code));
        } catch (e) {
          return alert('Ungültiger Code!');
        }
        if (!Array.isArray(imported)) return alert('Ungültige Daten!');
        saveHiddenModels(imported);
        document.querySelectorAll('tbody tr').forEach(row => {
          const model = row.children[2]?.innerText.trim();
          const cb = row.querySelector('.toggle-row');
          if (imported.includes(model)) {
            row.style.display = 'none';
            if (cb) cb.checked = false;
          } else {
            row.style.display = '';
            if (cb) cb.checked = true;
          }
        });
        alert('Import abgeschlossen.');
      });
    });
  </script>

</body>
</html>
